{% extends 'base.html' %}

{% block title %}Cookie Settings - ShriekedIn{% endblock %}

{% block content %}
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-6 max-w-5xl">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-gray-900 mb-4">üç™ Cookie Settings üç™</h1>
                <p class="text-xl text-gray-600">Manage Your Cookie Preferences</p>
                <p class="text-sm text-gray-500 mt-4">Control how we use cookies on your device</p>
            </div>

            <!-- Content -->
            <div class="bg-white rounded-lg shadow-lg p-10 md:p-12">

                <!-- Intro Banner - Visually Distinct -->
                <div class="bg-gradient-to-r from-purple-100 to-purple-50 border border-purple-300 shadow-md p-6 mb-10 rounded-lg -mx-2">
                    <div class="flex items-start gap-3">
                        <span class="text-3xl flex-shrink-0">üç™</span>
                        <p class="text-purple-900 font-semibold text-base leading-relaxed m-0">
                            We use cookies to enhance your spooky experience. You can choose which types of cookies you're comfortable with. Essential cookies are required for the site to function and cannot be disabled.
                        </p>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="prose prose-lg max-w-none">

                    <!-- Cookie Preferences Form -->
                    <form id="cookie-preferences-form">

                        <!-- Essential Cookies -->
                        <div class="bg-green-50 border border-green-300 rounded-lg p-6 mb-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-green-900 mt-0 mb-2 flex items-center gap-2">
                                        <span>‚úì</span> Essential Cookies
                                    </h3>
                                    <p class="text-green-800 mb-3">
                                        These cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you such as setting your privacy preferences, logging in, or filling in forms.
                                    </p>
                                    <div class="text-sm text-green-700 bg-green-100 p-3 rounded">
                                        <p class="mb-2"><strong>Examples:</strong></p>
                                        <ul class="mb-0 space-y-1">
                                            <li>Authentication and login sessions</li>
                                            <li>Security and fraud prevention</li>
                                            <li>Load balancing</li>
                                            <li>Cookie consent preferences</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="ml-6 flex-shrink-0">
                                    <div class="bg-green-600 text-white px-4 py-2 rounded font-semibold text-sm">
                                        Always Active
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Functional Cookies -->
                        <div class="bg-blue-50 border border-blue-300 rounded-lg p-6 mb-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-blue-900 mt-0 mb-2 flex items-center gap-2">
                                        <span>‚öôÔ∏è</span> Functional Cookies
                                    </h3>
                                    <p class="text-blue-800 mb-3">
                                        These cookies enable enhanced functionality and personalisation. They may be set by us or by third party providers whose services we have added to our pages.
                                    </p>
                                    <div class="text-sm text-blue-700 bg-blue-100 p-3 rounded">
                                        <p class="mb-2"><strong>Examples:</strong></p>
                                        <ul class="mb-0 space-y-1">
                                            <li>Remember your preferences (theme, language)</li>
                                            <li>Enhanced search functionality</li>
                                            <li>Live chat support</li>
                                            <li>Social media features</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="ml-6 flex-shrink-0">
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="functional-cookies" class="sr-only peer" checked>
                                        <div class="w-14 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-6 peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Cookies -->
                        <div class="bg-purple-50 border border-purple-300 rounded-lg p-6 mb-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-purple-900 mt-0 mb-2 flex items-center gap-2">
                                        <span>üìä</span> Analytics Cookies
                                    </h3>
                                    <p class="text-purple-800 mb-3">
                                        These cookies allow us to count visits and traffic sources so we can measure and improve the performance of our site. They help us know which pages are most and least popular.
                                    </p>
                                    <div class="text-sm text-purple-700 bg-purple-100 p-3 rounded">
                                        <p class="mb-2"><strong>Examples:</strong></p>
                                        <ul class="mb-0 space-y-1">
                                            <li>Google Analytics (anonymised)</li>
                                            <li>Page view statistics</li>
                                            <li>User behavior analysis</li>
                                            <li>Performance monitoring</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="ml-6 flex-shrink-0">
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="analytics-cookies" class="sr-only peer" checked>
                                        <div class="w-14 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-6 peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Marketing Cookies -->
                        <div class="bg-orange-50 border border-orange-300 rounded-lg p-6 mb-6">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-orange-900 mt-0 mb-2 flex items-center gap-2">
                                        <span>üì¢</span> Marketing Cookies
                                    </h3>
                                    <p class="text-orange-800 mb-3">
                                        These cookies may be set through our site by our advertising partners. They may be used to build a profile of your interests and show you relevant adverts on other sites.
                                    </p>
                                    <div class="text-sm text-orange-700 bg-orange-100 p-3 rounded">
                                        <p class="mb-2"><strong>Examples:</strong></p>
                                        <ul class="mb-0 space-y-1">
                                            <li>Targeted advertising</li>
                                            <li>Remarketing campaigns</li>
                                            <li>Social media advertising</li>
                                            <li>Email marketing preferences</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="ml-6 flex-shrink-0">
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="marketing-cookies" class="sr-only peer">
                                        <div class="w-14 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-6 peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-orange-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-wrap gap-4 justify-center mt-10 pt-8 border-t border-gray-200">
                            <button type="button" id="save-preferences" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                üíæ Save My Preferences
                            </button>
                            <button type="button" id="accept-all" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                ‚úì Accept All Cookies
                            </button>
                            <button type="button" id="reject-all" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                ‚úó Reject Optional Cookies
                            </button>
                        </div>

                    </form>

                    <!-- Success Message (Hidden by default) -->
                    <div id="success-message" class="hidden bg-green-50 border-l-4 border-green-500 p-6 mt-8 rounded-r-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">‚úì</span>
                            <div>
                                <p class="text-green-900 font-semibold m-0">Your cookie preferences have been saved!</p>
                                <p class="text-green-700 text-sm m-0 mt-1">Your settings will be applied across the site.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="bg-gray-50 border border-gray-300 rounded-lg p-6 mt-10">
                        <h3 class="text-lg font-bold text-gray-900 mt-0 mb-3">Need More Information?</h3>
                        <p class="text-gray-700 mb-3">
                            For more details about how we use cookies and protect your data, please visit:
                        </p>
                        <div class="flex flex-wrap gap-4">
                            <a href="{% url 'core:privacy' %}" class="text-purple-600 hover:text-purple-800 font-semibold underline">
                                Privacy Policy
                            </a>
                            <span class="text-gray-400">‚Ä¢</span>
                            <a href="{% url 'core:terms' %}" class="text-purple-600 hover:text-purple-800 font-semibold underline">
                                Terms & Conditions
                            </a>
                        </div>
                    </div>

                </div>
                <!-- End Main Content -->

            </div>

            <!-- Navigation -->
            <div class="text-center mt-8">
                <a href="{% url 'core:home' %}" class="text-purple-600 hover:text-purple-800 font-semibold">
                    ‚Üê Back to Home
                </a>
            </div>

        </div>
    </section>
{% endblock %}

{% block extra_js %}
<script>
    // Cookie management functions (from cookiebar.html)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    // Load current preferences
    document.addEventListener('DOMContentLoaded', function() {
        const consent = getCookie('cookie_consent');
        const preferences = getCookie('cookie_preferences');

        if (preferences) {
            try {
                const prefs = JSON.parse(preferences);
                document.getElementById('functional-cookies').checked = prefs.functional !== false;
                document.getElementById('analytics-cookies').checked = prefs.analytics !== false;
                document.getElementById('marketing-cookies').checked = prefs.marketing !== false;
            } catch (e) {
                console.error('Error parsing cookie preferences:', e);
            }
        }
    });

    // Save preferences
    document.getElementById('save-preferences').addEventListener('click', function() {
        const preferences = {
            essential: true, // Always true
            functional: document.getElementById('functional-cookies').checked,
            analytics: document.getElementById('analytics-cookies').checked,
            marketing: document.getElementById('marketing-cookies').checked
        };

        setCookie('cookie_consent', 'custom', 365);
        setCookie('cookie_preferences', JSON.stringify(preferences), 365);

        showSuccessMessage();
        console.log('üç™ Cookie preferences saved:', preferences);
    });

    // Accept all cookies
    document.getElementById('accept-all').addEventListener('click', function() {
        document.getElementById('functional-cookies').checked = true;
        document.getElementById('analytics-cookies').checked = true;
        document.getElementById('marketing-cookies').checked = true;

        const preferences = {
            essential: true,
            functional: true,
            analytics: true,
            marketing: true
        };

        setCookie('cookie_consent', 'accepted', 365);
        setCookie('cookie_preferences', JSON.stringify(preferences), 365);

        showSuccessMessage();
        console.log('üç™ All cookies accepted!');
    });

    // Reject optional cookies
    document.getElementById('reject-all').addEventListener('click', function() {
        document.getElementById('functional-cookies').checked = false;
        document.getElementById('analytics-cookies').checked = false;
        document.getElementById('marketing-cookies').checked = false;

        const preferences = {
            essential: true,
            functional: false,
            analytics: false,
            marketing: false
        };

        setCookie('cookie_consent', 'declined', 365);
        setCookie('cookie_preferences', JSON.stringify(preferences), 365);

        showSuccessMessage();
        console.log('üç™ Optional cookies rejected. Essential cookies only.');
    });

    // Show success message
    function showSuccessMessage() {
        const message = document.getElementById('success-message');
        message.classList.remove('hidden');

        // Scroll to message
        message.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        // Hide after 5 seconds
        setTimeout(function() {
            message.classList.add('hidden');
        }, 5000);
    }
</script>
{% endblock %}
